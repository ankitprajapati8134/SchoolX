"Schools":{
"Maharishi Vidhya Mandir, Balaghat": {
        "Accounts": {
        "Account_book": {
          "Fees": {
            "April": {
              "1 April 2024": {
                "Opening": "",
                "Payment": "",
                "Received": "",
                
              },
              "6 April 2024": {
                "Payment": "",
                "Received": "",
                
              }
            },
            "August": {
              "1 August 2024": {
                "Opening": "",
                "Payment": "",
                "Received": "",
                
              },
              "6 August 2024": {
                "Payment": "",
                "Received": "",
                
              }
            },
            "Created On": "08/10/2024",
            "December": {
              "1 December 2024": {
                "Opening": "",
                "Payment": "",
                "Received": "",
                
              },
              "6 December 2024": {
                "Payment": "",
                "Received": "",
                
              }
            },
            "February": {
              "1 February 2024": {
                "Opening": "",
                "Payment": "",
                "Received": "",
                
              },
              "6 February 2024": {
                "Payment": "",
                "Received": "",
                
              }
            },
            "January": {
              "1 January 2024": {
                "Opening": "",
                "Payment": "",
                "Received": "",
                
              },
              "6 January 2024": {
                "Payment": "",
                "Received": "",
                
              }
            },
            "July": {
              "1 July 2024": {
                "Opening": "",
                "Payment": "",
                "Received": "",
                
              },
              "6 July 2024": {
                "Payment": "",
                "Received": "",
                
              }
            },
            "June": {
              "1 June 2024": {
                "Opening": "",
                "Payment": "",
                "Received": "",
                
              },
              "6 June 2024": {
                "Payment": "",
                "Received": "",
                
              }
            },
            "March": {
              "1 March 2024": {
                "Opening": "",
                "Payment": "",
                "Received": "",
                
              },
              "6 March 2024": {
                "Payment": "",
                "Received": "",
                
              }
            },
            "May": {
              "1 May 2024": {
                "Opening": "",
                "Payment": "",
                "Received": "",
                
              },
              "6 May 2024": {
                "Payment": "",
                "Received": "",
                
              }
            },
            "November": {
              "1 November 2024": {
                "Opening": "",
                "Payment": "",
                "Received": "",
                
              },
              "7 November 2024": {
                "Payment": "",
                "Received": "",
                
              }
            },
            "October": {
              "1 October 2024": {
                "Opening": "",
                "Payment": "",
                "Received": "",
                
              },
              "6 October 2024": {
                "Payment": "",
                "Received": "",
                
              }
            },
            "September": {
              "1 September 2024": {
                "Opening": "",
                "Payment": "",
                "Received": "",
                
              },
              "10 September 2024": {
                "Payment": "",
                "Received": "",
                
              }
            },
            "Under": "INDIRECT EXPENSES"
          },
          "Salary": {
            "April": {
              "1": {
                "Opening": "",
                "Payment": "",
                "Received": ""
                
              },
             
            },
            "August": {
              "1": {
                "Payment": "",
                "Received": "",
                
              },
             
            },
            "Created On": "08/10/2024",
            "December": {
              "1": {
                "Payment": "",
                "Received": "",
                
              },
             
            },
            "February": {
              "1": {
                "Payment": "",
                "Received": "",
                
              },
             
            },
            "January": {
              "1": {
                "Payment": "",
                "Received": "",
                
              },
             
            },
            "July": {
              "1": {
                "Payment": "",
                "Received": "",
                
              },
             
            },
            "June": {
              "1": {
                "Payment": "",
                "Received": "",
                
              },
             
            },
            "March": {
              "1": {
                "Payment": "",
                "Received": "",
                
              },
             
            },
            "May": {
              "1": {
                "Payment": "",
                "Received": "",
                
              },
              "6": {
                "Opening": "1000",
                "Payment": "",
                "Received": "",
                
              }
             
            },
            "November": {
              "1": {
                "Payment": "",
                "Received": "",
                
              },
            },
            "October": {
              "1": {
                "Payment": "",
                "Received": "",
                
              },
             
            },
            "September": {
              "1": {
                "Opening": "",
                "Payment": "",
                "Received": "",
                
              },
              
            },
            "Under": "INDIRECT EXPENSES"
          }

   
   
   
          <div class="content-wrapper">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h3 class="bg-warning p-2 text-center">Account Book</h3>
            </div>
        </div>

        <div class="row">
            <!-- Left Side: Form -->
            <div class="col-md-6" id="formSection">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title" id="formTitle"><strong>Create New Account</strong></h4>
                    </div>
                    <div class="panel-body">
                        <form id="accountForm">
                            <div class="form-group">
                                <label for="accountName">Enter Account Name:</label>
                                <input type="text" class="form-control" id="accountName"
                                    placeholder="Enter account name">
                            </div>
                            <div class="form-group">
                                <label for="subGroup">Sub Group Of:</label>
                                <select class="form-control" id="subGroup">
                                    <option value="Select Sub Group">Select Sub Group</option>
                                    <option value="CASH & BANK ACCOUNT">CASH & BANK ACCOUNT</option>
                                    <option value="CURRENT ASSETS">CURRENT ASSETS</option>
                                    <option value="MOVABLE ASSETS">MOVABLE ASSETS</option>
                                    <option value="STOCK IN HAND">STOCK IN HAND</option>
                                    <option value="SUNDRY DEBTORS">SUNDRY DEBTORS</option>
                                    <option value="DUTY & TAXES">DUTY & TAXES</option>
                                    <option value="CURRENT LIABILITIES">CURRENT LIABILITIES</option>
                                    <option value="SECURED LOAN">SECURED LOAN</option>
                                    <option value="SUNDRY CREDITORS">SUNDRY CREDITORS</option>
                                    <option value="UNSECURED LOAN">UNSECURED LOAN</option>
                                    <option value="PERSONAL EXP.">PERSONAL EXP.</option>
                                    <option value="DIRECT EXPENSES">DIRECT EXPENSES</option>
                                    <option value="FURNITURE ACCOUNT">FURNITURE ACCOUNT</option>
                                    <option value="FIXED ASSETS">FIXED ASSETS</option>
                                    <option value="OFFICE EQUIPMENT">OFFICE EQUIPMENT</option>
                                    <option value="PLANT & MACHINERY ACCOUNT">PLANT & MACHINERY ACCOUNT</option>
                                    <option value="ADMINISTRATION EXP.">ADMINISTRATION EXP.</option>
                                    <option value="INDIRECT EXPENSES">INDIRECT EXPENSES</option>
                                    <option value="ADVERTISEMENT & PUBLICITY EXP.">ADVERTISEMENT & PUBLICITY EXP.
                                    </option>
                                    <option value="FINANCIAL EXP.">FINANCIAL EXP.</option>
                                    <option value="VEHICLES">VEHICLES</option>
                                    <option value="MOVEABLE ASSETS">MOVEABLE ASSETS</option>
                                    <option value="DIRECT EXP.">DIRECT EXP.</option>
                                    <option value="REVENUE ACCOUNT">REVENUE ACCOUNT</option>
                                    <option value="INCOME FROM OTHER SOURCES">INCOME FROM OTHER SOURCES</option>
                                    <option value="PURCHASE ACCOUNT">PURCHASE ACCOUNT</option>
                                    <option value="SALE ACCOUNT">SALE ACCOUNT</option>
                                    <!-- More options here -->
                                </select>
                            </div>
                            <div class="form-group" id="openingAmountContainer">
                                <label for="Openingamount">Enter Opening Amount:</label>
                                <input type="text" class="form-control" id="Openingamount"
                                    placeholder="Enter Opening Amount">
                            </div>
                            <div class="form-group">
                                <button type="button" class="btn btn-primary" id="createUpdateBtn">Create</button>
                                <button type="button" class="btn btn-secondary" id="formBackBtn"
                                    style="display: none;">Back</button>
                            </div>

                        </form>
                    </div>
                </div>
            </div>

            <!-- Right Side: Table -->
            <div class="col-md-6" id="rightTable">
                <div class="table-responsive">
                    <!-- account_book.php -->

                    <table class="table table-striped" id="accountTable">
                        <thead class="thead-light">
                            <tr>
                                <th>Sr. No</th>
                                <th>Account Name</th>
                                <th>Sub Group</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?php
        // Check if there are accounts
        if (!empty($accounts)) {
            $sr_no = 1; // Initialize the serial number
            foreach ($accounts as $account_id => $account) {
                // Assuming the account name and sub group are stored in the account object
                $account_name = isset($account['Name']) ? $account['Name'] : 'N/A'; // Replace with actual field
                $sub_group = isset($account['Under']) ? $account['Under'] : 'N/A'; // Replace with actual field
                ?>
                            <tr data-id="<?php echo $account_id; ?>">
                                <td><?php echo $sr_no++; ?></td> <!-- Increment serial number -->
                                <td><?php echo htmlspecialchars($account_id); ?></td> <!-- Escape output -->
                                <td><?php echo htmlspecialchars($sub_group); ?></td> <!-- Escape output -->
                            </tr>
                            <?php
            }
        } else {
            // If no accounts found, display a message
            echo '<tr><td colspan="3" class="text-center">No accounts found.</td></tr>';
        }
        ?>
                        </tbody>
                    </table>

                </div>
                <div class="text-center">
                    <button id="viewBtn" class="btn btn-success btn-disabled">View</button>
                    <button id="updateBtn" class="btn btn-primary btn-disabled">Edit</button>
                    <button id="deleteBtn" class="btn btn-danger btn-disabled">Delete</button>
                </div>
            </div>
        </div>

        <!-- View Account Page (Initially Hidden) -->
        <div class="row hidden" id="viewPage" style="display: none;">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <!-- Account Information -->
                        <div class="account-info">
                            <h4 id="schoolName" class="text-center"><?php echo htmlspecialchars($school_name); ?></h4>
                            <div class="info-grid">
                                <h5><strong>Account:</strong> <span id="selectedAccountName"
                                        class="font-weight-normal"></span></h5>
                                <h5><strong>Sub Group:</strong> <span id="selectedSubGroup"
                                        class="font-weight-normal"></span></h5>
                                <h5><strong>Created On:</strong> <span id="createdOn"
                                        class="font-weight-normal"><?php echo htmlspecialchars($created_on); ?></span>
                                </h5>
                                <h5><strong>Current Session:</strong> <span id="currentSession"
                                        class="font-weight-normal"><?php echo htmlspecialchars($current_session); ?></span>
                                </h5>
                            </div>
                        </div>

                        <p class="text-center font-weight-bold">Monthwise Transactions</p>

                        <!-- Transactions Table -->
                        <table class="table table-bordered" id="transactionsTable">
                            <thead>
                                <tr>
                                    <th>Month</th>
                                    <th>Opening</th>
                                    <th>Received</th>
                                    <th>Payments</th>
                                    <th>Balance</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>April</td>
                                    <td id="April-opening"></td>
                                    <td id="April-received"></td>
                                    <td id="April-payment"></td>
                                    <td id="April-balance"></td>
                                </tr>
                                <tr>
                                    <td>May</td>
                                    <td id="May-opening"></td>
                                    <td id="May-received"></td>
                                    <td id="May-payment"></td>
                                    <td id="May-balance"></td>
                                </tr>
                                <tr>
                                    <td>June</td>
                                    <td id="June-opening"></td>
                                    <td id="June-received"></td>
                                    <td id="June-payment"></td>
                                    <td id="June-balance"></td>
                                </tr>
                                <tr>
                                    <td>July</td>
                                    <td id="July-opening"></td>
                                    <td id="July-received"></td>
                                    <td id="July-payment"></td>
                                    <td id="July-balance"></td>
                                </tr>
                                <tr>
                                    <td>August</td>
                                    <td id="August-opening"></td>
                                    <td id="August-received"></td>
                                    <td id="August-payment"></td>
                                    <td id="August-balance"></td>
                                </tr>
                                <tr>
                                    <td>SeptOctober</td>
                                    <td id="SeptOctober-opening"></td>
                                    <td id="SeptOctober-received"></td>
                                    <td id="SeptOctober-payment"></td>
                                    <td id="SeptOctober-balance"></td>
                                </tr>
                                <tr>
                                    <td>October</td>
                                    <td id="October-opening"></td>
                                    <td id="October-received"></td>
                                    <td id="October-payment"></td>
                                    <td id="October-balance"></td>
                                </tr>
                                <tr>
                                    <td>November</td>
                                    <td id="November-opening"></td>
                                    <td id="November-received"></td>
                                    <td id="November-payment"></td>
                                    <td id="November-balance"></td>
                                </tr>
                                <tr>
                                    <td>December</td>
                                    <td id="December-opening"></td>
                                    <td id="December-received"></td>
                                    <td id="December-payment"></td>
                                    <td id="December-balance"></td>
                                </tr>
                                <tr>
                                    <td>January</td>
                                    <td id="January-received"></td>
                                    <td id="January-opening"></td>
                                    <td id="January-balance"></td>
                                    <td id="January-payment"></td>
                                </tr>
                                <tr>
                                    <td>February</td>
                                    <td id="February-opening"></td>
                                    <td id="February-received"></td>
                                    <td id="February-payment"></td>
                                    <td id="February-balance"></td>
                                </tr>
                                <tr>
                                    <td>March</td>
                                    <td id="March-opening"></td>
                                    <td id="March-received"></td>
                                    <td id="March-payment"></td>
                                    <td id="March-balance"></td>
                                </tr>

                                ?>
                            <tfoot>
                                <tr>
                                    <td><strong>Total</strong></td>
                                    <td></td>
                                    <td><?php echo htmlspecialchars($total_received); ?></td>
                                    <td><?php echo htmlspecialchars($total_payments); ?></td>
                                    <td></td>
                                </tr>
                            </tfoot>
                            </tbody>
                        </table>

                        <!-- Action Buttons -->
                        <div class="text-right">
                            <button class="btn btn-primary" onclick="printReceipt()">Print</button>
                            <button id="backBtn" class="btn btn-secondary">Back</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal fade" id="deleteConfirmationModal" tabindex="-1" role="dialog"
            aria-labelledby="deleteModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalLabel"><strong>Confirm Delete</strong></h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        Are you sure you want to delete this account? This action cannot be undone, and all information
                        related to this account will be lost.
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                    </div>
                </div>
            </div>
        </div>


    </div>
</div>

<script>
function printReceipt() {
    window.print();
}
// Toggle selection and unselection of rows
let rows = document.querySelectorAll('#accountTable tbody tr');
rows.forEach(function(row) {
    row.onclick = function() {
        if (row.classList.contains('selected', 'highlighted')) {
            row.classList.remove('selected', 'highlighted'); // Unselect if already selected
        } else {
            rows.forEach(r => r.classList.remove('selected',
                'highlighted')); // Remove highlight from all rows
            row.classList.add('selected', 'highlighted'); // Highlight this row
        }

        // Toggle button states based on selection
        let isSelected = row.classList.contains('selected');
        document.getElementById('viewBtn').classList.toggle('btn-disabled', !isSelected);
        document.getElementById('updateBtn').classList.toggle('btn-disabled', !isSelected);
        document.getElementById('deleteBtn').classList.toggle('btn-disabled', !isSelected);
    };
});

document.getElementById('deleteBtn').onclick = function() {
    let selectedRow = document.querySelector('#accountTable tbody tr.selected');
    if (selectedRow) {
        // Show the delete confirmation modal
        $('#deleteConfirmationModal').modal('show');

        // Handle delete confirmation
        document.getElementById('confirmDeleteBtn').onclick = function() {
            // Perform the delete action here, such as making an AJAX request to delete the account
            console.log('Deleting account:', selectedRow.cells[1].textContent);

            // Hide the modal after delete
            $('#deleteConfirmationModal').modal('hide');

            // Optionally, remove the deleted row from the table
            selectedRow.remove();
        };
    } else {
        alert('Please select an account to delete.');
    }
};



document.getElementById('viewBtn').onclick = function() {
    let selectedRow = document.querySelector('#accountTable tbody tr.selected');
    if (selectedRow) {
        // Make an AJAX call to fetch the data
        $.ajax({
            url: '<?php echo base_url("account/populateTable"); ?>',
            type: 'GET',
            success: function(response) {
                // Hide form and table
                document.getElementById('formSection').style.display = 'none';
                document.getElementById('rightTable').style.display = 'none';

                // Display selected account info
                document.getElementById('selectedAccountName').textContent = selectedRow.cells[1].textContent;
                document.getElementById('selectedSubGroup').textContent = selectedRow.cells[2].textContent;

                // Update month-wise transaction table dynamically with response data
                let data = JSON.parse(response);
                for (const [month, values] of Object.entries(data.monthData)) {
                    document.getElementById(`${month}-opening`).textContent = values.opening;
                    document.getElementById(`${month}-received`).textContent = values.received;
                    document.getElementById(`${month}-payment`).textContent = values.payment;
                    document.getElementById(`${month}-balance`).textContent = values.balance;
                }

                // Display viewPage
                let viewPage = document.getElementById('viewPage');
                viewPage.classList.remove('hidden');
                viewPage.style.display = 'block';
            },
            error: function(xhr, status, error) {
                alert('Error fetching data from server: ' + error);
            }
        });
    } else {
        alert('Please select an account to view.');
    }
};


document.getElementById('backBtn').onclick = function() {
    document.getElementById('formSection').style.display = 'block';
    document.getElementById('rightTable').style.display = 'block';
    document.getElementById('viewPage').style.display = 'none';
};

document.getElementById('updateBtn').onclick = function() {
    let selectedRow = document.querySelector('#accountTable tbody tr.selected');
    if (selectedRow) {
        // Pre-fill the form with selected row data
        document.getElementById('accountName').value = selectedRow.cells[1].textContent;

        // Ensure the subgroup option is selected correctly
        let subGroupValue = selectedRow.cells[2].textContent;
        let subGroupSelect = document.getElementById('subGroup');
        subGroupSelect.value = subGroupValue;

        // Hide the "Opening Amount" field
        document.getElementById('openingAmountContainer').style.display = 'none';

        // Update the form title and button
        document.getElementById('formTitle').textContent = 'Update Account';
        document.getElementById('formTitle').style.fontWeight = 'bold';
        document.getElementById('createUpdateBtn').textContent = 'Update';

        // Show the back button
        document.getElementById('formBackBtn').style.display = 'inline-block';
    }
};

// Show the "Opening Amount" field when the back button is clicked
document.getElementById('formBackBtn').onclick = function() {
    document.getElementById('openingAmountContainer').style.display = 'block';
};


// Back button logic for form section
document.getElementById('formBackBtn').onclick = function() {
    // Reset form to its initial state
    document.getElementById('accountName').value = '';
    document.getElementById('subGroup').value = 'Select Sub Group';

    // Change back to Create mode
    document.getElementById('formTitle').textContent = 'Create New Account';
    document.getElementById('createUpdateBtn').textContent = 'Create';

    // Hide the back button
    document.getElementById('formBackBtn').style.display = 'none';
};


document.getElementById('createUpdateBtn').onclick = function() {
    let btnText = document.getElementById('createUpdateBtn').textContent;
    if (btnText === 'Create') {
        // Handle account creation logic here
    } else if (btnText === 'Update') {
        // Handle account update logic here
    }
};

// Custom CSS to ensure row highlighting works with table striping and to handle bold borders
document.write(`
    <style>
    /* Highlighted row */
    .highlighted {
        background-color: #5bc0de !important;  /* Light blue for highlighting */
        color: white;
    }
    .btn-disabled {
        pointer-events: none;
        opacity: 0.5;
    }
    #viewPage h5 {
        display: block;
        margin-bottom: 0.5rem;
    }
    /* Reduce padding in table cells */
    #transactionsTable th, #transactionsTable td {
        padding: 5px !important; /* Smaller padding */
        border: 2px solid #000 !important;  /* Bold borders */
    }

    /* Background color for account info */
    .account-info {
        background-color: #f8f9fa;  /* Light background color */
        padding: 15px;  /* Add padding */
        border: 1px solid #ddd;  /* Optional border */
        border-radius: 5px;  /* Rounded corners */
        margin-bottom: 20px;  /* Space below */
    }
    .info-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr); /* 2 columns */
    gap: 5px; /* Space between items */
}

    /* Bold weight for labels */
    #viewPage .font-weight-bold {
        font-weight: bold !important;
    }

    /* Background styling for account information */
    .account-info h5 {
        background-color: #ffdfba; /* Light orange background */
        padding: 10px;
        border-radius: 3px;
        font-size: 16px;
    }
</style>
`);
</script>